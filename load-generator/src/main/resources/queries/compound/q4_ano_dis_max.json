{
  "size": 50,
  "track_total_hits": true,
  "query": {
    "bool": {
      "filter": [
        {
          "term": {
            "dssCustomMetadataPayrollInfo.payrollType": "{{payroll_type}}"
          }
        },
        {
          "term": {
            "dssCustomMetadataPayrollInfo.language": "{{language}}"
          }
        },
        {
          "range": {
            "dssCustomMetadataPayrollInfo.accountingYear": {
              "gte": "{{year_from}}",
              "lte": "{{year_to}}"
            }
          }
        },
        {
          "term": {
            "dssCustomMetadataPayrollInfo.accountingMonth": "{{month}}"
          }
        }
      ],
      "must": [
        {
          "dis_max": {
            "tie_breaker": 0.2,
            "queries": [
              {
                "term": {
                  "dssOriginalFilename.raw": "{{filename}}"
                }
              },
              {
                "wildcard": {
                  "dssOriginalFilename.raw": "*{{filename_fragment}}*"
                }
              },
              {
                "term": {
                  "dssCreationUserDisplayName.raw": "{{creator_name}}"
                }
              },
              {
                "match_phrase": {
                  "customAll": {
                    "query": "{{doc_phrase}}",
                    "slop": 2
                  }
                }
              },
              {
                "match": {
                  "customAll": {
                    "query": "{{search_terms}}",
                    "operator": "and",
                    "fuzziness": "AUTO"
                  }
                }
              },
              {
                "match_phrase": {
                  "customAll": {
                    "query": "{{search_terms}}",
                    "slop": 3
                  }
                }
              }
            ]
          }
        }
      ]
    }
  },
  "_source": [
    "dssDocumentName",
    "dssOriginalFilename",
    "dssCreationUserDisplayName",
    "dssCustomMetadataPayrollInfo.payrollType",
    "dssCustomMetadataPayrollInfo.language",
    "dssCustomMetadataPayrollInfo.accountingYear",
    "dssCustomMetadataPayrollInfo.accountingMonth",
    "dssCustomMetadataPayrollInfo.provisionDate"
  ]
}
